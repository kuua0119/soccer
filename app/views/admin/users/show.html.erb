<div class="card shadow-sm mb-4">
  <div class="card-body">
    <% if @user.avatar.attached? %>
      <%= image_tag @user.avatar.variant(resize_to_fill: [150, 150]), class: "rounded-circle shadow-sm mb-3", alt: @user.name %>
    <% else %>
      <%= image_tag "profile.jpg", width: 150, height: 150, class: "rounded-circle shadow-sm mb-3", alt: "デフォルトユーザー" %>
    <% end %>

    <h4 class="card-title"><%= @user.name.present? ? @user.name : "退会済みユーザー" %> さんの詳細</h4>
    <p><strong>Email:</strong> <%= @user.email %></p>
    <p><strong>登録日:</strong> <%= l @user.created_at, format: :long %></p>
    <p><strong>ステータス:</strong>
      <% if @user.is_banned? %>
        <span class="badge bg-warning text-dark">凍結中</span>
      <% else %>
        <span class="badge bg-success">有効</span>
      <% end %>
    </p>
  </div>
</div>

<div class="card shadow-sm mb-4">
  <div class="card-header bg-light">
    <i class="fas fa-pen"></i> 投稿一覧
  </div>
  <div class="card-body">
    <% if @user.posts.any? %>
      <ul>
        <% @user.posts.each do |post| %>
          <li>
            <%= link_to post.title, admin_post_path(post) %> 
            <small class="text-muted">（<%= l post.created_at, format: :short %>）</small>
          </li>
        <% end %>
      </ul>
    <% else %>
      <p class="text-muted">投稿はありません</p>
    <% end %>
  </div>
</div>

<div class="card shadow-sm mb-4">
  <div class="card-header bg-light">
    <i class="fas fa-comment"></i> コメント一覧
  </div>
  <div class="card-body">
    <% if @user.comments.any? %>
      <ul>
        <% @user.comments.each do |comment| %>
          <li>
            <%= truncate(comment.body, length: 50) %>
            <small class="text-muted">（投稿: <%= link_to comment.post.title, admin_post_path(comment.post) %>）</small>
          </li>
        <% end %>
      </ul>
    <% else %>
      <p class="text-muted">コメントはありません</p>
    <% end %>
  </div>
</div>

<div class="card shadow-sm mb-4">
  <div class="card-header bg-light">
    <i class="fas fa-users"></i> 参加コミュニティ一覧
  </div>
  <div class="card-body">
    <% if @user.communities.any? %>
      <ul>
        <% @user.communities.each do |community| %>
          <li>
            <%= link_to community.community_name, admin_community_path(community) %>
          </li>
        <% end %>
      </ul>
    <% else %>
      <p class="text-muted">参加中のコミュニティはありません</p>
    <% end %>
  </div>
</div>

<div class="d-flex gap-2">
  <% if @user.is_banned? %>
    <%= button_to "凍結解除", unban_admin_user_path(@user), method: :patch, class: "btn btn-success" %>
  <% else %>
    <%= button_to "凍結する", ban_admin_user_path(@user), method: :patch, data: { confirm: "このユーザーを凍結してもよろしいですか？" }, class: "btn btn-warning" %>
  <% end %>
  <%= link_to "一覧に戻る", admin_users_path, class: "btn btn-secondary" %>
</div>